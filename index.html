<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Snake Game</title>
  <meta name="description" content="The Brand New Web Site">
  <meta name="author" content="Barattalo.it">
  <!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->
  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body>



  <!-- run javascript at the end -->
  <script>

console.log("starting program");
  //CONSTANTS
  var COLS=26, ROWS=26;

  //IDS
  var EMPTY=0, SNAKE=1, FRUIT=2;
  //Directions
  var LEFT=0, UP=1, RIGHT=2, DOWN=3;


  var grid = {
    width: null,
    heigth: null,
    _grid: null,


    init: function(d, c, r) {
      this.width = c;
      this.height = r;

      this._grid = [];
      for (var x=0; x < c; x++) {
        this._grid.push([]);
        for (var y=0; y < r; y++) {
          this._grid[x].push(d);
        }
      }
    },

    set: function(val, x, y){
      this._grid[x][y] = val;

    },

    get: function(x, y){
      return this._grid[x][y];
    }
  }

  var snake = {

    direction: null,
    _queue: null,
    last: null,

    init: function(d, x, y) {
      this.direction = d;

      this._queue = [];
      this.insert(x,y);

    },

    insert: function(x, y) {
      this._queue.unshift({x:x, y:y}); //put at start of file
      this.last = this._queue[0];

    },

    remove: function(){
      return this._queue.pop();

    }


  }


  function setFood(){
    var emptyCells = [];
    for (var x=0; x < grid.width; x++) {
      for (var y=0; y < grid.height; y++) {
        if (grid.get(x,y) === EMPTY) {
          emptyCells.push({x:x, y:y});
        }
      }
    }
    var randompos = emptyCells[Math.floor(Math.random()*emptyCells.length)];
    grid.set(FRUIT, randompos.x, randompos.y)
  }

  //Game OBJECTS
  var canvas, ctx, keystate, frames;


  function main(){
    console.log("here")
    canvas = document.createElement("canvas")
    console.log("canvas")
    canvas.width = COLS*20;
    canvas.height = ROWS*20;
    ctx = canvas.getContext("2d");
    document.body.appendChild(canvas);

    frames = 0;
    keystate = {};

    init();
    loop();
  }

  function init(){
    console.log("vaing init")
    grid.init(EMPTY, COLS, ROWS);

    var sp = {x:Math.floor(COLS/2), y:ROWS-1};
    console.log(sp);
    snake.init(UP, sp.x, sp.y);
    grid.set(SNAKE, sp.x, sp.y);

    setFood();
  }




  window.requestAnimationFrame(loop, canvas);

  function update(){
    frames++;

  }

  function draw(){
    console.log("draw method")
    var tw = canvas.width/grid.width;
    var th = canvas.height/grid.height;


    for (var x=0; x < grid.width; x++) {
      for (var y=0; y < grid.height; y++)

      switch (grid.get(x, y)) {
        case EMPTY:
        ctx.fillStyle = "#fff"
        break;
        case SNAKE:
        ctx.fillStyle = "#0ff"
        break;
        case FRUIT:
        ctx.fillStyle = "#f00"
        break;

        break;
        default:

      }
      ctx.fillRect(x*tw, y*th, tw, th);

    }
  }

  function loop(){}
  main();
  update();
  draw();




</script>
</body>
</html>
